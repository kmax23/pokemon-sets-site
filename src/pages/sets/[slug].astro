---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllSets, getSetById, getCardsBySet } from "../../lib/firestore.server.js";

export async function getStaticPaths() {
  const sets = await getAllSets();
  return sets.map(s => ({ params: { slug: s.id } }));
}

const { slug } = Astro.params;
const set = await getSetById(slug);
if (!set) throw new Error(`Set not found: ${slug}`);
const cards = await getCardsBySet(slug);
---

<BaseLayout title={`${set.name} Checklist`}>
  <h1 class="text-3xl font-bold mb-2">{set.name}</h1>
  <p class="text-gray-600 mb-6">{set.totalCards} cards â€” released {set.releaseDate}</p>

  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    {cards.map(card => (
      <a href={`/cards/${card.slug}/`} class="block bg-white p-3 rounded shadow hover:shadow-lg">
        <img src={card.imageUrl} alt={card.name} class="w-full h-40 object-contain mb-2"/>
        <h3 class="font-semibold">{card.name}</h3>
        <p class="text-sm text-gray-500">{card.rarity}</p>
      </a>
    ))}
  </div>
</BaseLayout>
