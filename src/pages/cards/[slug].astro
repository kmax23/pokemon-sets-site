---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllCards, getCardBySlug } from "../../lib/firestore.server.js";

export async function getStaticPaths() {
  const cards = await getAllCards();
  return cards.map(c => ({ params: { slug: c.slug } }));
}

const { slug } = Astro.params;
const card = await getCardBySlug(slug);
if (!card) throw new Error(`Card not found: ${slug}`);
---

<BaseLayout title={`${card.name} — ${card.setName}`}>
  <div class="max-w-2xl mx-auto bg-white rounded-xl p-6 shadow">
    <img src={card.imageUrl} alt={card.name} class="w-full object-contain mb-6"/>
    <h1 class="text-3xl font-bold">{card.name}</h1>
    <p class="text-gray-600 mb-2">#{card.number} • {card.rarity} • {card.setName}</p>

    <div class="mt-4 space-y-2">
      <a href={card.buyLink ?? "https://tcgplayer.com"} target="_blank" class="block bg-blue-600 text-white px-4 py-2 rounded">Buy on TCGplayer</a>
      <p class="text-sm text-gray-500 mt-2">Affiliate disclosure: we may earn a commission for purchases.</p>
    </div>
  </div>
</BaseLayout>
